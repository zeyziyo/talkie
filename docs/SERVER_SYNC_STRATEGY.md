# 🧭 서버 사이드 피봇 동기화 및 ID 통합 전략 (Server-Side Pivot Sync & ID Unification Strategy)

**목적**: 이 문서는 Talkie 앱의 핵심 데이터 동기화 방향성을 정의합니다. 개발 진행 중 방향을 잃었을 때, 이 로직을 최우선 기준으로 삼아 판단합니다.

## 🔄 핵심 로직: 수동 입력 흐름 (Manual Input Flow)

1.  **입력 (Input)**
    *   사용자가 `Mode 1`에서 단어(예: "사과")를 입력합니다.

2.  **로컬 검색 (Local Search)**
    *   앱이 로컬 DB에서 해당 단어를 검색합니다. (검색 실패 시 다음 단계로 진행)

3.  **임시 ID 생성 (Temp ID)**
    *   앱이 임시 그룹 ID(타임스탬프 기반)를 생성하여 일단 저장합니다. (사용자 경험 끊김 방지)

4.  **서버 요청 (Request)**
    *   앱이 서버에 **번역 및 ID 조회**를 요청합니다.
    *   요청 데이터: Source "사과" (KO) → Pivot "Apple" (EN) & Target "Manzana" (ES)

5.  **서버 확인 (Server Check)**
    *   서버는 **"Apple" (영어 피봇)**을 기준으로 기존 데이터베이스를 검색합니다.
    *   피봇 언어(영어)는 전 세계 모든 언어를 연결하는 **유일한 키(Key)** 역할을 합니다.

6.  **응답 (Response)**
    *   **Case A: 찾음 (Found)**
        *   서버가 기존의 **`정식 그룹 ID`**와 Target "Manzana"를 반환합니다.
    *   **Case B: 없음 (Not Found)**
        *   서버가 **`새로운 정식 그룹 ID`**를 발급하고, Target "Manzana" + Pivot "Apple"을 함께 반환합니다.

7.  **업데이트 (ID Swap)**
    *   앱이 로컬 DB에 저장된 `임시 그룹 ID`를 서버로부터 받은 **`정식 그룹 ID`**로 교체합니다.
    *   이 과정은 **Self-Healing** 방식으로 백그라운드에서 조용히 처리됩니다.

8.  **동기화 (Sync)**
    *   최종적으로 정식 ID를 가진 데이터가 로컬과 서버 양쪽에 일치하게 됩니다.

---
**작성일**: 2026-02-08
**상태**: Phase 80 구현 기준 문서
